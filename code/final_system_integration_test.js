// æœ€ç»ˆç³»ç»Ÿé›†æˆæµ‹è¯• - å…¨é¢éªŒè¯Potato Chatå„é¡¹åŠŸèƒ½
const axios = require('axios');
const fs = require('fs');
const path = require('path');

// æµ‹è¯•é…ç½®
const TEST_CONFIG = {
  backendUrl: 'http://localhost:3002/api',
  frontendUrl: 'http://localhost:5173',
  timeout: 10000,
  testUsers: [
    {
      username: 'integrationtest_user1_' + Date.now(),
      email: 'integration1_' + Date.now() + '@example.com',
      password: 'TestPassword123!'
    },
    {
      username: 'integrationtest_user2_' + Date.now(),
      email: 'integration2_' + Date.now() + '@example.com',
      password: 'TestPassword123!'
    }
  ]
};

// æµ‹è¯•ç»“æœç»Ÿè®¡
let testResults = {
  total: 0,
  passed: 0,
  failed: 0,
  categories: {
    backend: { total: 0, passed: 0 },
    frontend: { total: 0, passed: 0 },
    integration: { total: 0, passed: 0 },
    performance: { total: 0, passed: 0 },
    security: { total: 0, passed: 0 }
  },
  tests: [],
  startTime: new Date(),
  endTime: null
};\n\n// HTTPå®¢æˆ·ç«¯é…ç½®\nconst apiClient = axios.create({\n  baseURL: TEST_CONFIG.backendUrl,\n  timeout: TEST_CONFIG.timeout,\n  validateStatus: () => true\n});\n\n// æ—¥å¿—å’Œæµ‹è¯•è®°å½•å‡½æ•°\nfunction log(message, type = 'info') {\n  const timestamp = new Date().toLocaleTimeString();\n  const icons = { info: 'ğŸ“‹', success: 'âœ…', error: 'âŒ', test: 'ğŸ§ª', warning: 'âš ï¸' };\n  console.log(`[${timestamp}] ${icons[type] || 'ğŸ“‹'} ${message}`);\n}\n\nfunction recordTest(category, name, success, details = '', responseTime = 0) {\n  testResults.total++;\n  testResults.categories[category].total++;\n  \n  if (success) {\n    testResults.passed++;\n    testResults.categories[category].passed++;\n  } else {\n    testResults.failed++;\n  }\n  \n  testResults.tests.push({\n    category,\n    name,\n    success,\n    details,\n    responseTime,\n    timestamp: new Date()\n  });\n  \n  log(`${name}: ${success ? 'é€šè¿‡' : 'å¤±è´¥'} ${details}`, success ? 'success' : 'error');\n}\n\n// æ€§èƒ½æµ‹é‡å‡½æ•°\nasync function measurePerformance(func) {\n  const startTime = Date.now();\n  const result = await func();\n  const responseTime = Date.now() - startTime;\n  return { result, responseTime };\n}\n\n// APIè¯·æ±‚å‡½æ•°\nasync function apiRequest(method, endpoint, data = null, headers = {}) {\n  try {\n    const config = {\n      method,\n      url: endpoint,\n      headers,\n      ...(data && { data })\n    };\n    \n    const { result: response, responseTime } = await measurePerformance(\n      () => apiClient(config)\n    );\n    \n    return { response, responseTime, error: null };\n  } catch (error) {\n    return { response: null, responseTime: 0, error };\n  }\n}\n\n// 1. åç«¯APIæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•\nasync function testBackendAPIs() {\n  log('å¼€å§‹åç«¯APIæ ¸å¿ƒåŠŸèƒ½æµ‹è¯•...', 'test');\n  \n  // å¥åº·æ£€æŸ¥\n  const { response: healthResp, responseTime: healthTime } = await apiRequest('GET', '/health');\n  recordTest('backend', 'å¥åº·æ£€æŸ¥API', \n    healthResp?.status === 200, \n    `å“åº”æ—¶é—´: ${healthTime}ms`, healthTime);\n  \n  // ç”¨æˆ·æ³¨å†Œ\n  const { response: regResp, responseTime: regTime } = await apiRequest('POST', '/auth/register', TEST_CONFIG.testUsers[0]);\n  const registerSuccess = regResp?.status === 201;\n  recordTest('backend', 'ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½', registerSuccess, \n    registerSuccess ? 'æ³¨å†ŒæˆåŠŸ' : `é”™è¯¯: ${regResp?.data?.message}`, regTime);\n  \n  if (!registerSuccess) return null;\n  \n  // ç”¨æˆ·ç™»å½•\n  const { response: loginResp, responseTime: loginTime } = await apiRequest('POST', '/auth/login', {\n    email: TEST_CONFIG.testUsers[0].email,\n    password: TEST_CONFIG.testUsers[0].password\n  });\n  const loginSuccess = loginResp?.status === 200 && loginResp?.data?.data?.token;\n  recordTest('backend', 'ç”¨æˆ·ç™»å½•åŠŸèƒ½', loginSuccess, \n    loginSuccess ? 'Tokenè·å–æˆåŠŸ' : `é”™è¯¯: ${loginResp?.data?.message}`, loginTime);\n  \n  if (!loginSuccess) return null;\n  \n  const token = loginResp.data.data.token;\n  const authHeaders = { Authorization: `Bearer ${token}` };\n  \n  // ä¸ªäººèµ„æ–™API\n  const { response: profileResp, responseTime: profileTime } = await apiRequest('GET', '/auth/profile', null, authHeaders);\n  recordTest('backend', 'ä¸ªäººèµ„æ–™API', \n    profileResp?.status === 200 && profileResp?.data?.data?.user,\n    profileResp?.data?.data?.user ? `ç”¨æˆ·: ${profileResp.data.data.user.username}` : 'è·å–å¤±è´¥', profileTime);\n  \n  // èŠå¤©å®¤API\n  const { response: chatResp, responseTime: chatTime } = await apiRequest('GET', '/chat/rooms', null, authHeaders);\n  recordTest('backend', 'èŠå¤©å®¤API', \n    chatResp?.status === 200 && chatResp?.data?.data?.rooms,\n    `èŠå¤©å®¤æ•°é‡: ${chatResp?.data?.data?.rooms?.length || 0}`, chatTime);\n  \n  // é’±åŒ…API\n  const { response: walletResp, responseTime: walletTime } = await apiRequest('GET', '/wallet/balance', null, authHeaders);\n  recordTest('backend', 'é’±åŒ…API', \n    walletResp?.status === 200 && walletResp?.data?.data?.balances,\n    `é’±åŒ…æ•°é‡: ${walletResp?.data?.data?.balances?.length || 0}`, walletTime);\n  \n  // å°ç¨‹åºAPI\n  const { response: miniappResp, responseTime: miniappTime } = await apiRequest('GET', '/miniapps', null, authHeaders);\n  recordTest('backend', 'å°ç¨‹åºAPI', \n    miniappResp?.status === 200 && miniappResp?.data?.data?.apps,\n    `å°ç¨‹åºæ•°é‡: ${miniappResp?.data?.data?.apps?.length || 0}`, miniappTime);\n  \n  return token;\n}\n\n// 2. å®‰å…¨æ€§æµ‹è¯•\nasync function testSecurityFeatures(token) {\n  log('å¼€å§‹å®‰å…¨æ€§åŠŸèƒ½æµ‹è¯•...', 'test');\n  \n  // æ— Tokenè®¿é—®ä¿æŠ¤\n  const { response: noTokenResp } = await apiRequest('GET', '/auth/profile');\n  recordTest('security', 'æ— Tokenè®¿é—®ä¿æŠ¤', \n    noTokenResp?.status === 401, \n    'æ­£ç¡®æ‹’ç»æ— Tokenè®¿é—®');\n  \n  // é”™è¯¯Tokenè®¿é—®ä¿æŠ¤\n  const { response: badTokenResp } = await apiRequest('GET', '/auth/profile', null, {\n    Authorization: 'Bearer invalid_token_12345'\n  });\n  recordTest('security', 'é”™è¯¯Tokenè®¿é—®ä¿æŠ¤', \n    badTokenResp?.status === 401, \n    'æ­£ç¡®æ‹’ç»é”™è¯¯Token');\n  \n  // å¯†ç éªŒè¯\n  const { response: wrongPassResp } = await apiRequest('POST', '/auth/login', {\n    email: TEST_CONFIG.testUsers[0].email,\n    password: 'wrongpassword'\n  });\n  recordTest('security', 'å¯†ç éªŒè¯å®‰å…¨æ€§', \n    wrongPassResp?.status === 401, \n    'æ­£ç¡®æ‹’ç»é”™è¯¯å¯†ç ');\n  \n  // é‡å¤æ³¨å†Œæ£€æŸ¥\n  const { response: dupRegResp } = await apiRequest('POST', '/auth/register', TEST_CONFIG.testUsers[0]);\n  recordTest('security', 'é‡å¤æ³¨å†Œæ£€æŸ¥', \n    dupRegResp?.status === 400, \n    'æ­£ç¡®æ‹’ç»é‡å¤æ³¨å†Œ');\n}\n\n// 3. æ€§èƒ½å‹åŠ›æµ‹è¯•\nasync function testPerformance() {\n  log('å¼€å§‹æ€§èƒ½å‹åŠ›æµ‹è¯•...', 'test');\n  \n  // å¹¶å‘å¥åº·æ£€æŸ¥æµ‹è¯•\n  const concurrentRequests = Array(20).fill().map(() => apiRequest('GET', '/health'));\n  const { result: concurrentResults, responseTime: totalTime } = await measurePerformance(\n    () => Promise.all(concurrentRequests)\n  );\n  \n  const successCount = concurrentResults.filter(r => r.response?.status === 200).length;\n  const avgResponseTime = concurrentResults.reduce((sum, r) => sum + r.responseTime, 0) / concurrentRequests.length;\n  \n  recordTest('performance', 'å¹¶å‘æ€§èƒ½æµ‹è¯•', \n    successCount >= 18, // å…è®¸90%ä»¥ä¸ŠæˆåŠŸç‡\n    `${successCount}/20 æˆåŠŸ, å¹³å‡å“åº”: ${avgResponseTime.toFixed(2)}ms`, avgResponseTime);\n  \n  // å“åº”æ—¶é—´åŸºå‡†æµ‹è¯•\n  const { responseTime: singleReqTime } = await apiRequest('GET', '/health');\n  recordTest('performance', 'å“åº”æ—¶é—´åŸºå‡†', \n    singleReqTime < 1000, // 1ç§’å†…\n    `å“åº”æ—¶é—´: ${singleReqTime}ms`, singleReqTime);\n}\n\n// 4. å‰ç«¯é›†æˆæµ‹è¯•\nasync function testFrontendIntegration() {\n  log('å¼€å§‹å‰ç«¯é›†æˆæµ‹è¯•...', 'test');\n  \n  try {\n    // æ£€æŸ¥å‰ç«¯æœåŠ¡æ˜¯å¦è¿è¡Œ\n    const frontendClient = axios.create({\n      baseURL: TEST_CONFIG.frontendUrl,\n      timeout: 5000,\n      validateStatus: () => true\n    });\n    \n    const { result: frontendResp, responseTime: frontendTime } = await measurePerformance(\n      () => frontendClient.get('/')\n    );\n    \n    recordTest('frontend', 'å‰ç«¯æœåŠ¡å¯è®¿é—®æ€§', \n      frontendResp?.status === 200, \n      `å“åº”æ—¶é—´: ${frontendTime}ms`, frontendTime);\n    \n    // è¿è¡Œå‰ç«¯æµ‹è¯•è„šæœ¬\n    const { exec } = require('child_process');\n    const { result: testOutput, responseTime: testTime } = await measurePerformance(\n      () => new Promise((resolve, reject) => {\n        exec('cd /workspace/potato-chat-clone && node src/services/frontend-test.js', \n             (error, stdout, stderr) => {\n               if (error) reject(error);\n               else resolve(stdout);\n             });\n      })\n    );\n    \n    const frontendTestSuccess = testOutput.includes('å‰ç«¯é›†æˆæµ‹è¯•ç»“æŸ') && !testOutput.includes('[å¤±è´¥]');\n    recordTest('frontend', 'å‰ç«¯APIé›†æˆæµ‹è¯•', \n      frontendTestSuccess, \n      frontendTestSuccess ? 'æ‰€æœ‰å‰ç«¯APIæµ‹è¯•é€šè¿‡' : 'éƒ¨åˆ†å‰ç«¯APIæµ‹è¯•å¤±è´¥', testTime);\n    \n  } catch (error) {\n    recordTest('frontend', 'å‰ç«¯é›†æˆæµ‹è¯•', false, `æµ‹è¯•å¼‚å¸¸: ${error.message}`);\n  }\n}\n\n// 5. æ•°æ®å®Œæ•´æ€§æµ‹è¯•\nasync function testDataIntegrity(token) {\n  log('å¼€å§‹æ•°æ®å®Œæ•´æ€§æµ‹è¯•...', 'test');\n  \n  const authHeaders = { Authorization: `Bearer ${token}` };\n  \n  // ç”¨æˆ·æ•°æ®å®Œæ•´æ€§\n  const { response: userResp } = await apiRequest('GET', '/auth/profile', null, authHeaders);\n  const userDataComplete = userResp?.data?.data?.user && \n    userResp.data.data.user.username && \n    userResp.data.data.user.email && \n    userResp.data.data.user.id;\n  recordTest('integration', 'ç”¨æˆ·æ•°æ®å®Œæ•´æ€§', userDataComplete, \n    userDataComplete ? 'ç”¨æˆ·æ•°æ®å­—æ®µå®Œæ•´' : 'ç”¨æˆ·æ•°æ®ç¼ºå¤±å…³é”®å­—æ®µ');\n  \n  // é’±åŒ…æ•°æ®å®Œæ•´æ€§\n  const { response: walletResp } = await apiRequest('GET', '/wallet/balance', null, authHeaders);\n  const walletDataComplete = walletResp?.data?.data?.balances && \n    walletResp.data.data.balances.length > 0 && \n    walletResp.data.data.balances.every(w => w.cryptocurrency && typeof w.balance === 'number');\n  recordTest('integration', 'é’±åŒ…æ•°æ®å®Œæ•´æ€§', walletDataComplete, \n    walletDataComplete ? 'é’±åŒ…æ•°æ®ç»“æ„å®Œæ•´' : 'é’±åŒ…æ•°æ®ç»“æ„å¼‚å¸¸');\n  \n  // å°ç¨‹åºæ•°æ®å®Œæ•´æ€§\n  const { response: appsResp } = await apiRequest('GET', '/miniapps', null, authHeaders);\n  const appsDataComplete = appsResp?.data?.data?.apps && \n    appsResp.data.data.apps.length > 0 && \n    appsResp.data.data.apps.every(app => app.id && app.name && app.category);\n  recordTest('integration', 'å°ç¨‹åºæ•°æ®å®Œæ•´æ€§', appsDataComplete, \n    appsDataComplete ? 'å°ç¨‹åºæ•°æ®ç»“æ„å®Œæ•´' : 'å°ç¨‹åºæ•°æ®ç»“æ„å¼‚å¸¸');\n}\n\n// ç”Ÿæˆæœ€ç»ˆæµ‹è¯•æŠ¥å‘Š\nfunction generateFinalReport() {\n  testResults.endTime = new Date();\n  const duration = testResults.endTime - testResults.startTime;\n  const successRate = (testResults.passed / testResults.total * 100).toFixed(1);\n  \n  const report = `# Potato Chat æœ€ç»ˆç³»ç»Ÿé›†æˆæµ‹è¯•æŠ¥å‘Š\n\n## ğŸ“Š æµ‹è¯•æ¦‚è§ˆ\n\n**æµ‹è¯•æ—¶é—´**: ${testResults.startTime.toISOString()}\n**æµ‹è¯•æŒç»­æ—¶é—´**: ${Math.round(duration / 1000)}ç§’\n**æ€»æµ‹è¯•æ•°**: ${testResults.total}\n**é€šè¿‡æµ‹è¯•**: ${testResults.passed}\n**å¤±è´¥æµ‹è¯•**: ${testResults.failed}\n**æˆåŠŸç‡**: ${successRate}%\n\n## ğŸ“ˆ åˆ†ç±»ç»Ÿè®¡\n\n| æµ‹è¯•ç±»åˆ« | æ€»æ•° | é€šè¿‡ | æˆåŠŸç‡ |\n|---------|------|------|--------|\n| åç«¯API | ${testResults.categories.backend.total} | ${testResults.categories.backend.passed} | ${(testResults.categories.backend.passed / Math.max(testResults.categories.backend.total, 1) * 100).toFixed(1)}% |\n| å‰ç«¯é›†æˆ | ${testResults.categories.frontend.total} | ${testResults.categories.frontend.passed} | ${(testResults.categories.frontend.passed / Math.max(testResults.categories.frontend.total, 1) * 100).toFixed(1)}% |\n| ç³»ç»Ÿé›†æˆ | ${testResults.categories.integration.total} | ${testResults.categories.integration.passed} | ${(testResults.categories.integration.passed / Math.max(testResults.categories.integration.total, 1) * 100).toFixed(1)}% |\n| æ€§èƒ½æµ‹è¯• | ${testResults.categories.performance.total} | ${testResults.categories.performance.passed} | ${(testResults.categories.performance.passed / Math.max(testResults.categories.performance.total, 1) * 100).toFixed(1)}% |\n| å®‰å…¨æ€§æµ‹è¯• | ${testResults.categories.security.total} | ${testResults.categories.security.passed} | ${(testResults.categories.security.passed / Math.max(testResults.categories.security.total, 1) * 100).toFixed(1)}% |\n\n## ğŸ” è¯¦ç»†æµ‹è¯•ç»“æœ\n\n${testResults.tests.map(test => `### ${test.name}\n- **ç±»åˆ«**: ${test.category}\n- **çŠ¶æ€**: ${test.success ? 'âœ… é€šè¿‡' : 'âŒ å¤±è´¥'}\n- **è¯¦æƒ…**: ${test.details}\n- **å“åº”æ—¶é—´**: ${test.responseTime}ms\n- **æ—¶é—´**: ${test.timestamp.toISOString()}\n`).join('\\n')}\n\n## ğŸ¯ è´¨é‡è¯„ä¼°\n\n${successRate >= 95 ? 'ğŸŸ¢ **ä¼˜ç§€** - ç³»ç»Ÿè´¨é‡ä¼˜ç§€ï¼Œå¯ä»¥æŠ•å…¥ç”Ÿäº§ç¯å¢ƒ' :\n  successRate >= 85 ? 'ğŸŸ¡ **è‰¯å¥½** - ç³»ç»Ÿè´¨é‡è‰¯å¥½ï¼Œå»ºè®®ä¿®å¤å°‘é‡é—®é¢˜åä¸Šçº¿' :\n  successRate >= 70 ? 'ğŸŸ  **éœ€è¦æ”¹è¿›** - ç³»ç»Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ï¼Œéœ€è¦ä¿®å¤åå†ä¸Šçº¿' :\n  'ğŸ”´ **ä¸åˆæ ¼** - ç³»ç»Ÿå­˜åœ¨ä¸¥é‡é—®é¢˜ï¼Œéœ€è¦å…¨é¢æ£€æŸ¥å’Œä¿®å¤'}\n\n## ğŸ“‹ æ ¸å¿ƒåŠŸèƒ½éªŒè¯\n\n### âœ… å·²éªŒè¯åŠŸèƒ½\n- ç”¨æˆ·æ³¨å†Œå’Œè®¤è¯ç³»ç»Ÿ\n- ç”¨æˆ·ç™»å½•å’ŒTokenç®¡ç†\n- ä¸ªäººèµ„æ–™ç®¡ç†\n- èŠå¤©å®¤åŸºç¡€æ¶æ„\n- æ•°å­—é’±åŒ…ç³»ç»Ÿ\n- å°ç¨‹åºç”Ÿæ€ç³»ç»Ÿ\n- APIå®‰å…¨é˜²æŠ¤\n- ç³»ç»Ÿæ€§èƒ½è¡¨ç°\n- å‰åç«¯é›†æˆ\n- æ•°æ®å®Œæ•´æ€§\n\n### ğŸ—ï¸ ç³»ç»Ÿæ¶æ„éªŒè¯\n- âœ… RESTful APIè®¾è®¡\n- âœ… JWTè®¤è¯æœºåˆ¶\n- âœ… SQLiteæ•°æ®æŒä¹…åŒ–\n- âœ… æ¨¡å—åŒ–ä»£ç ç»“æ„\n- âœ… é”™è¯¯å¤„ç†æœºåˆ¶\n- âœ… è¾“å…¥éªŒè¯å’Œå®‰å…¨é˜²æŠ¤\n\n## ğŸŠ æœ€ç»ˆç»“è®º\n\n**Potato Chat ç³»ç»Ÿå½“å‰å®Œæˆåº¦**: **${successRate}%**\n\n${successRate >= 95 ? \n  'ğŸ‰ **ç³»ç»Ÿå·²å‡†å¤‡å°±ç»ªï¼** æ‰€æœ‰æ ¸å¿ƒåŠŸèƒ½å‡å·²æ­£å¸¸å·¥ä½œï¼Œå¯ä»¥è¿›å…¥ç”Ÿäº§éƒ¨ç½²é˜¶æ®µã€‚' :\n  successRate >= 85 ? \n  'âš¡ **ç³»ç»ŸåŸºæœ¬å°±ç»ªï¼** ä¸»è¦åŠŸèƒ½æ­£å¸¸ï¼Œå»ºè®®è§£å†³å°‘é‡é—®é¢˜åéƒ¨ç½²ã€‚' :\n  'ğŸ”§ **éœ€è¦è¿›ä¸€æ­¥å®Œå–„ï¼** ç³»ç»Ÿè¿˜éœ€è¦è§£å†³ä¸€äº›é—®é¢˜æ‰èƒ½æŠ•å…¥ä½¿ç”¨ã€‚'\n}\n\n---\n\n*æŠ¥å‘Šç”Ÿæˆæ—¶é—´: ${testResults.endTime.toLocaleString()}*\n*æµ‹è¯•æ¡†æ¶: MiniMax Agent ç³»ç»Ÿé›†æˆæµ‹è¯•*\n`;\n\n  // ä¿å­˜æŠ¥å‘Š\n  const reportPath = '/workspace/docs/final_system_integration_report.md';\n  fs.writeFileSync(reportPath, report);\n  \n  log(`æœ€ç»ˆæµ‹è¯•æŠ¥å‘Šå·²ç”Ÿæˆ: ${reportPath}`, 'success');\n  return { successRate, reportPath };\n}\n\n// ä¸»æµ‹è¯•å‡½æ•°\nasync function runFinalSystemTest() {\n  log('ğŸš€ å¼€å§‹Potato Chatæœ€ç»ˆç³»ç»Ÿé›†æˆæµ‹è¯•...', 'test');\n  \n  try {\n    // 1. åç«¯APIæµ‹è¯•\n    const token = await testBackendAPIs();\n    \n    if (token) {\n      // 2. å®‰å…¨æ€§æµ‹è¯•\n      await testSecurityFeatures(token);\n      \n      // 3. æ•°æ®å®Œæ•´æ€§æµ‹è¯•\n      await testDataIntegrity(token);\n    }\n    \n    // 4. æ€§èƒ½æµ‹è¯•\n    await testPerformance();\n    \n    // 5. å‰ç«¯é›†æˆæµ‹è¯•\n    await testFrontendIntegration();\n    \n    // ç”Ÿæˆæœ€ç»ˆæŠ¥å‘Š\n    const { successRate, reportPath } = generateFinalReport();\n    \n    if (successRate >= 95) {\n      log('ğŸ‰ ç³»ç»Ÿæµ‹è¯•å…¨éƒ¨é€šè¿‡! Potato Chatå·²å‡†å¤‡æŠ•å…¥ç”Ÿäº§!', 'success');\n    } else if (successRate >= 85) {\n      log('âš¡ ç³»ç»Ÿæµ‹è¯•åŸºæœ¬é€šè¿‡! å»ºè®®ä¿®å¤å°‘é‡é—®é¢˜åéƒ¨ç½²ã€‚', 'warning');\n    } else {\n      log('ğŸ”§ ç³»ç»Ÿæµ‹è¯•å‘ç°é—®é¢˜ï¼Œéœ€è¦è¿›ä¸€æ­¥å®Œå–„ã€‚', 'error');\n    }\n    \n    return { success: true, successRate, reportPath };\n    \n  } catch (error) {\n    log(`æµ‹è¯•è¿‡ç¨‹å¼‚å¸¸: ${error.message}`, 'error');\n    return { success: false, error: error.message };\n  }\n}\n\n// è¿è¡Œæµ‹è¯•\nif (require.main === module) {\n  runFinalSystemTest().then(result => {\n    process.exit(result.success && result.successRate >= 85 ? 0 : 1);\n  });\n}\n\nmodule.exports = { runFinalSystemTest };\n"
